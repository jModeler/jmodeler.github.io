<!doctype html><!-- This site was created with Wowchemy. https://www.wowchemy.com --><!-- Last Published: March 20, 2023 --><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.7.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><script src=/js/mathjax-config.js></script>
<link rel=stylesheet href=/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin=anonymous media=print onload='this.media="all"'><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script>
<link rel=stylesheet href=/css/wowchemy.0f229d4b7ebad1917a9a357cba2effab.css><link rel=stylesheet href=/css/libs/chroma/github-light.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"' disabled><meta name=author content="The Journeyman Modeler"><meta name=description content="I recently read a paper (Heiss and Winschel 2008) that advocated the use of certain techniques (Sparse Grids, SG henceforth) in numerical integration to calculate likelihood functions, as opposed to using Monte Carlo (MC henceforth) methods for the same."><link rel=alternate hreflang=en-us href=https://jmodeler.github.io/post/numerical-integration-with-sparse-grids/><link rel=canonical href=https://jmodeler.github.io/post/numerical-integration-with-sparse-grids/><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#1565c0"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://jmodeler.github.io/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png"><meta property="og:site_name" content="The Journeyman Modeler"><meta property="og:url" content="https://jmodeler.github.io/post/numerical-integration-with-sparse-grids/"><meta property="og:title" content="Numerical Integration with Sparse Grids | The Journeyman Modeler"><meta property="og:description" content="I recently read a paper (Heiss and Winschel 2008) that advocated the use of certain techniques (Sparse Grids, SG henceforth) in numerical integration to calculate likelihood functions, as opposed to using Monte Carlo (MC henceforth) methods for the same."><meta property="og:image" content="https://jmodeler.github.io/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2023-03-20T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-20T07:55:39-04:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://jmodeler.github.io/post/numerical-integration-with-sparse-grids/"},"headline":"Numerical Integration with Sparse Grids","datePublished":"2023-03-20T00:00:00Z","dateModified":"2023-03-20T07:55:39-04:00","author":{"@type":"Person","name":"The Journeyman Modeler"},"publisher":{"@type":"Organization","name":"The Journeyman Modeler","logo":{"@type":"ImageObject","url":"https://jmodeler.github.io/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_3.png"}},"description":"I recently read a paper (Heiss and Winschel 2008) that advocated the use of certain techniques (Sparse Grids, SG henceforth) in numerical integration to calculate likelihood functions, as opposed to using Monte Carlo (MC henceforth) methods for the same."}</script><title>Numerical Integration with Sparse Grids | The Journeyman Modeler</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=cf75ca437285b8551c18a341952e1f70><script src=/js/wowchemy-init.min.ec9d49ca50e4b80bdb08f0417a28ed84.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>The Journeyman Modeler</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>The Journeyman Modeler</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></header></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>Numerical Integration with Sparse Grids</h1><div class=article-metadata><span class=article-date>Last updated on
Mar 20, 2023</span>
<span class=middot-divider></span>
<span class=article-reading-time>5 min read</span>
<span class=middot-divider></span>
<span class=article-categories><i class="fas fa-folder mr-1"></i><a href=/category/scientific-computing/>Scientific Computing</a></span></div></div><div class=article-container><div class=article-style><p>I recently read a paper <span class=citation>(<a href=#ref-heiss2008likelihood role=doc-biblioref>Heiss and Winschel 2008</a>)</span> that advocated the use of certain techniques (Sparse Grids, SG henceforth) in numerical integration to calculate likelihood functions, as opposed to using Monte Carlo (MC henceforth) methods for the same. While approximating integrals with MC methods are simpler to implement, they might lead to integral values with considerable simulation error <span class=citation>(<a href=#ref-skrainka2011high role=doc-biblioref>Skrainka and Judd 2011</a>)</span>. This post attempts to demonstrate the claim in <span class=citation>Skrainka and Judd (<a href=#ref-skrainka2011high role=doc-biblioref>2011</a>)</span> using two very simple integrals, to which we already know the value. I attempt to compare the outcomes from using MC and SG.</p><p>The integrals I’ll be evaluating are:</p><p><span class="math display" id=eq:sumint>\[\begin{equation}
\int_{-\infty}^{\infty} \left( \sum_{i=1}^{5} x_i \right) dF_{X} \tag{1}
\end{equation}\]</span></p><p>and
<span class="math display" id=eq:prodint>\[\begin{equation}
\int_{-\infty}^{\infty} \left( \prod_{i=1}^{5} x_i^2 \right) dF_{X} \tag{2}
\end{equation}\]</span></p><p>where <span class="math inline">\(X = \{x_i\}_{i=1}^{5}\)</span> is a five dimensional random variable, which is distributed according to the multivariate standard normal:
<span class="math display">\[
X \sim N\left( \left[ \begin{array}
{r}
0 \\
0 \\
0 \\
0 \\
0 \\
\end{array}\right], \left[ \begin{array}
{rrrrr}
1 & 0 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 & 0 \\
0 & 0 & 1 & 0 & 0 \\
0 & 0 & 0 & 1 & 0 \\
0 & 0 & 0 & 0 & 1 \\
\end{array}\right] \right)
\]</span></p><p>Given the distribution of <span class="math inline">\(X\)</span>, the values of the integrals above are easily obtained from standard results (the value of <a href=#eq:sumint>(1)</a> is <span class="math inline">\(0\)</span> and that of <a href=#eq:prodint>(2)</a> is <span class="math inline">\(1\)</span>) respectively.</p><p>I write some utility functions in R to compute the integrands above:</p><pre class=r><code>#function to compute the sum of components of the random vector
s &lt;- function(x)
{
  return(sum(x))
}

#function to compute the square product of the components of the random vector
p &lt;- function(x)
{
  return(prod(x^2))
}</code></pre><p>I now write a function that:</p><ul><li>Simulates a certain number of draws from the distribution of the random variable <span class="math inline">\(X\)</span></li><li>Computes the integrand function using each of these draws as input</li><li>Takes the average of the values computed in the previous step</li></ul><p>This function, in effect, would give us the approximate value of the integral via MC methodology.</p><p>The code is provided below, note that I use the <tt><a href=https://cran.r-project.org/web/packages/mvtnorm/index.html>mvtnorm</a></tt> package to create random draws.</p><pre class=r><code>library(mvtnorm)

#Function to calculate the MC approximation for the integral
mc_int &lt;- function(s, n, mu, sigma)
{
  #generate random draws
  x &lt;- rmvnorm(n, mean = mu, sigma = sigma)
  #now get the integral
  mc_int_n &lt;- mean(apply(x, 1, s))
  return(mc_int_n)
}

set.seed(100)
n &lt;- 1000
mc_val &lt;- mc_int(s, n, mu = rep(0,5), sigma = diag(5))
mc_val</code></pre><pre><code>## [1] 0.007150433</code></pre><p>The result, 0.00715 is not far off from the true value of <span class="math inline">\(0\)</span> at first glance, however, we need to compare this to the result from the SG approach.</p><p>R has a package that generates sparse grids for numerical integration as described in <span class=citation>Heiss and Winschel (<a href=#ref-heiss2008likelihood role=doc-biblioref>2008</a>)</span>, called <tt><a href=https://cran.r-project.org/web/packages/SparseGrid/index.html>SparseGrid</a></tt>. We now use the nodes and weights generated from this package to approximate the first integral.
I re-use some of the code provided in the documentation for the <tt><a href=https://cran.r-project.org/web/packages/SparseGrid/vignettes/SparseGrid.pdf>SparseGrid</a></tt> package in R.</p><pre class=r><code>library(SparseGrid)

#generate sparse grids for a 5 dimensional RV with accuracy level 2
sg &lt;- createSparseGrid(type=&#39;KPN&#39;, dimension=5, k=2)


sg_int &lt;- function(func, sg, ...)
{
  gx &lt;- apply(sg$nodes, 1, function(x) {func(x, ...)})
  return(sum(gx * sg$weights))
}

sg_val &lt;- sg_int(s, sg)
sg_val</code></pre><pre><code>## [1] 0</code></pre><p>The result here is exactly 0. In light of this finding, the value obtained from the MC approach, in comparison, is a little off, and tends to show a high variance in output:</p><pre class=r><code>set.seed(100)

mc_int(s, n, mu = rep(0,5), sigma = diag(5))</code></pre><pre><code>## [1] 0.007150433</code></pre><pre class=r><code>mc_int(s, n, mu = rep(0,5), sigma = diag(5))</code></pre><pre><code>## [1] 0.03162326</code></pre><pre class=r><code>mc_int(s, n, mu = rep(0,5), sigma = diag(5))</code></pre><pre><code>## [1] -0.1287932</code></pre><pre class=r><code>mc_int(s, n, mu = rep(0,5), sigma = diag(5))</code></pre><pre><code>## [1] 0.01040134</code></pre><pre class=r><code>mc_int(s, n, mu = rep(0,5), sigma = diag(5))</code></pre><pre><code>## [1] -0.03798655</code></pre><p>In the third case, there is a <span class="math inline">\(-12\%\)</span> error(!) in the value of the computed integral when compared to the result from the SG approach. The SG approach, in addition, shows no such variation in repeated runs, since the grid values and weights are fixed for a given accuracy level and dimension (of the variable being integrated).</p><p>I repeat the calculations for the second integral, as shown below</p><p>MC approach:</p><pre class=r><code>set.seed(100)
n &lt;- 1000
mc_val &lt;- mc_int(p, n, mu = rep(0,5), sigma = diag(5))
mc_val</code></pre><pre><code>## [1] 1.001089</code></pre><p>SG approach:</p><pre class=r><code>#generate sparse grids for a 5 dimensional RV with accuracy level 6
sg &lt;- createSparseGrid(type=&#39;KPN&#39;, dimension=5, k=6)
sg_val &lt;- sg_int(p, sg)
sg_val</code></pre><pre><code>## [1] 1</code></pre><p>Once again, the SG approach gives us an exact value (note that the value of <span class="math inline">\(k\)</span>, the accuracy level, has gone up, since the integrand is a higher order function). Again, the difference of the results between the two approaches doesn’t seem that large. However, variability of the results from the MC approach is still a concern, as shown below:</p><pre class=r><code>set.seed(100)

mc_int(p, n, mu = rep(0,5), sigma = diag(5))</code></pre><pre><code>## [1] 1.001089</code></pre><pre class=r><code>mc_int(p, n, mu = rep(0,5), sigma = diag(5))</code></pre><pre><code>## [1] 0.4672555</code></pre><pre class=r><code>mc_int(p, n, mu = rep(0,5), sigma = diag(5))</code></pre><pre><code>## [1] 1.14692</code></pre><pre class=r><code>mc_int(p, n, mu = rep(0,5), sigma = diag(5))</code></pre><pre><code>## [1] 1.062975</code></pre><pre class=r><code>mc_int(p, n, mu = rep(0,5), sigma = diag(5))</code></pre><pre><code>## [1] 0.9112416</code></pre><p>In the second case, there is a roughly <span class="math inline">\(53\%\)</span> (!!) error when compared to the true value of the integral. This variability could be worse with more complicated integrands. One suggestion to reduce variability in MC methods is to increase the number of draws, but that would entail a lot of calculations and result in longer runtimes.</p><p>To conclude, we have shown with this simple example how results from numerical integration using MC methods have high variability, and more often than not, it would be good idea to increase the number of draws being used to approximate an integral, or use a different method altogether (SG).</p><div id=references class="section level2 unnumbered"><h2>References</h2><div id=refs class="references csl-bib-body hanging-indent"><div id=ref-mvt class=csl-entry>Genz, Alan, Frank Bretz, Tetsuhisa Miwa, Xuefei Mi, Friedrich Leisch, Fabian Scheipl, and Torsten Hothorn. 2019. <em><span class=nocase>mvtnorm</span>: Multivariate Normal and t Distributions</em>. <a href="https://CRAN.R-project.org/package=mvtnorm">https://CRAN.R-project.org/package=mvtnorm</a>.</div><div id=ref-heiss2008likelihood class=csl-entry>Heiss, Florian, and Viktor Winschel. 2008. <span>“Likelihood Approximation by Numerical Integration on Sparse Grids.”</span> <em>Journal of Econometrics</em> 144 (1): 62–80.</div><div id=ref-skrainka2011high class=csl-entry>Skrainka, Benjamin S, and Kenneth L Judd. 2011. <span>“High Performance Quadrature Rules: How Numerical Integration Affects a Popular Model of Product Differentiation.”</span> <em>Available at SSRN 1870703</em>.</div></div></div></div><div class=article-tags><a class="badge badge-light" href=/tag/numerical-integration/>Numerical Integration</a>
<a class="badge badge-light" href=/tag/sparse-grids/>Sparse Grids</a></div><div class=share-box><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fjmodeler.github.io%2Fpost%2Fnumerical-integration-with-sparse-grids%2F&amp;text=Numerical+Integration+with+Sparse+Grids" target=_blank rel=noopener class=share-btn-twitter aria-label=twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fjmodeler.github.io%2Fpost%2Fnumerical-integration-with-sparse-grids%2F&amp;t=Numerical+Integration+with+Sparse+Grids" target=_blank rel=noopener class=share-btn-facebook aria-label=facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Numerical%20Integration%20with%20Sparse%20Grids&amp;body=https%3A%2F%2Fjmodeler.github.io%2Fpost%2Fnumerical-integration-with-sparse-grids%2F" target=_blank rel=noopener class=share-btn-email aria-label=envelope><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fjmodeler.github.io%2Fpost%2Fnumerical-integration-with-sparse-grids%2F&amp;title=Numerical+Integration+with+Sparse+Grids" target=_blank rel=noopener class=share-btn-linkedin aria-label=linkedin-in><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=Numerical+Integration+with+Sparse+Grids%20https%3A%2F%2Fjmodeler.github.io%2Fpost%2Fnumerical-integration-with-sparse-grids%2F" target=_blank rel=noopener class=share-btn-whatsapp aria-label=whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Fjmodeler.github.io%2Fpost%2Fnumerical-integration-with-sparse-grids%2F&amp;title=Numerical+Integration+with+Sparse+Grids" target=_blank rel=noopener class=share-btn-weibo aria-label=weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><a href=https://jmodeler.github.io/><img class="avatar mr-3 avatar-circle" src=/authors/admin/avatar_hu5a47d3b10b27a53557ad791837831f89_346539_270x270_fill_q75_lanczos_center.jpg alt="The Journeyman Modeler"></a><div class=media-body><h5 class=card-title><a href=https://jmodeler.github.io/>The Journeyman Modeler</a></h5><p class=card-text>Curious about algorithms and methods at the intersection of Economics, Statistics and Computer Science.</p><ul class=network-icon aria-hidden=true><li><a href=https://github.com/jModeler target=_blank rel=noopener><i class="fab fa-github"></i></a></li></ul></div></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer><p class="powered-by copyright-license-text">© 2023 Me. This work is licensed under <a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank>CC BY NC ND 4.0</a></p><p class="powered-by footer-license-icons"><a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank aria-label="Creative Commons"><i class="fab fa-creative-commons fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-by fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nc fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nd fa-2x" aria-hidden=true></i></a></p><p class=powered-by>Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target=_blank rel=noopener>Wowchemy</a> — the free, <a href=https://github.com/wowchemy/wowchemy-hugo-themes target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></div></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script>
<script id=page-data type=application/json>{"use_headroom":true}</script><script src=/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js type=module></script>
<script src=/en/js/wowchemy.min.e8ee06ba8371980ffde659871dd593b0.js></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div><script src=/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js type=module></script></body></html>